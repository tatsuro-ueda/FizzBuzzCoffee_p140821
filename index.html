<!DOCTYPE html>
<html>
  <head>
    <title>JSアプリをCoffeeでTDDするイマドキの環境</title>
    <link href="css/reset.css" rel="stylesheet" />
    
    <meta charset="utf-8" />
    <meta name="viewport" content="width=1024" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <link rel="shortcut icon" href="css/favicon.png" />
    <link rel="apple-touch-icon" href="css/apple-touch-icon.png" />
    <!-- Code Prettifier: -->
<link href="css/highlight.css" type="text/css" rel="stylesheet" />
<script type="text/javascript" src="js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

    <link href="css/style.css" rel="stylesheet" />
<link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,800italic,300,400,800' rel='stylesheet' type='text/css'>    


  </head>

  <body>
  <div class="fallback-message">
  <p>Your browser <b>doesn't support the features required</b> by impress.js, so you are presented with a simplified version of this presentation.</p>
  <p>For the best experience please use the latest <b>Chrome</b>, <b>Safari</b> or <b>Firefox</b> browser.</p>
  </div>
    <div id="impress">
    <div class='step' >
    
<h2>JSアプリケーションを</h2>

<h2>CoffeeScriptでテスト駆動開発する</h2>

<h2>イマドキの環境を整える</h2>

<p><a href="https://travis-ci.org/weed/FizzBuzzCoffee_p140821"><img src="https://travis-ci.org/weed/FizzBuzzCoffee_p140821.svg?branch=master" alt="Build Status"></a></p>
</div>
      <div class='step' >
    
<h2>Keywords</h2>

<ul>
<li>npm</li>
<li>Gulp</li>
<li>Mocha + expectJS</li>
</ul>
</div>
      <div class='step' >
    
<h2>自己紹介</h2>

<p>植田達郎（@weed_7777）</p>

<ul>
<li>フリーランス

<ul>
<li>JavaScript</li>
<li>Objective-C</li>
</ul></li>
<li>趣味

<ul>
<li>自転車</li>
<li>城巡り</li>
</ul></li>
</ul>
</div>
      <div class='step' >
    
<h2>NPM</h2>

<p><img src="image/npm.png" alt="npm"></p>

<p>Nodeのbundler。ローカルにインストールするのがデフォルト。</p>

<h3>プロジェクトの初期化</h3>
<pre><code class='prettyprint '>$ npm init
</code></pre>
<h3>モジュールをインストール</h3>
<pre><code class='prettyprint '>$ npm install &lt; package-name &gt; --save-dev
</code></pre>
<h3>コマンドを実行</h3>
<pre><code class='prettyprint '>$ npm run &lt; command &gt;
</code></pre></div>
      <div class='step' >
    
<h2>Nodeプロジェクトの初期化</h2>

<p>まずは以下のように打つ。すると、対話形式でプロジェクトの情報を入力していくことができる。</p>
<pre><code class='prettyprint '>$ npm init

name: (presentation) FizzBuzzCoffee_p140821
version: (0.0.0)
entry point: (Gruntfile.js)
test command: mocha
git repository: git@github.com:weed/FizzBuzzCoffee_p140821.git
keywords:
author: Tatsuro Ueda
license: (ISC)
</code></pre></div>
      <div class='step' >
    
<p><code class='inline prettyprint'>--save-dev</code> オプション</p>

<p>インストールしたモジュールの情報を自動で <strong>package.json</strong> の <code class='inline prettyprint'>devDependencies</code> に書いてくれるオプション。</p>

<p>Development環境ではインストールされるが、Production環境ではインストールされない。</p>

<p>また、 <code class='inline prettyprint'>-g</code> オプションを付けていないので、モジュールはプロジェクトの <strong>node_modules/</strong> フォルダに保存され、プロジェクトの外側には何も残さない。</p>
</div>
      <div class='step' >
    
<h2>必要なモジュールをインストールする</h2>
<pre><code class='prettyprint '>$ npm install mocha --save-dev
$ npm install expect.js --save-dev
$ npm install coffee-script --save-dev
$ npm install gulp --save-dev
$ npm install gulp-coffee --save-dev
$ npm install gulp-mocha --save-dev
</code></pre></div>
      <div class='step' >
    
<h2>Gulp</h2>

<p><img src="image/gulp.png" alt="gulp"></p>

<ul>
<li>JavaScriptのMinifyやCSSプリプロセッサのコンパイルなどを行うことができるビルドツール</li>
</ul>
</div>
      <div class='step' >
    
<h2>Gruntと何が違うのか</h2>

<p><img src="image/grunt.png" alt="grunt"></p>

<h3>1. Easy to use</h3>

<p>コードでビルドタスクを実装するため、シンプルにタスクを定義することができます。</p>

<h3>2. Efficient</h3>

<p>node.jsのstream機能を用いているため、処理の中間ファイルなどを作ることなく、高速にビルドを行うことができます。</p>
</div>
      <div class='step' >
    
<h3>3. High Quality</h3>

<p>gulpのプラグインは厳しいガイドラインに従って作成されなければいけません。それに違反すればブラックリストに登録される可能性があります。そのため、プラグインの品質は高く保たれます。</p>

<h3>4. Easy to Learn</h3>

<p>gulpのAPIの数は最小に保たれています。そのため覚えることはかなり少なく、簡単に使い始めることができます。</p>
</div>
      <div class='step' >
    
<h2>coffeeをjsに変換するgulpfileを書く</h2>

<p><strong>gulpfile.js</strong></p>
<pre><code class='prettyprint '>require('coffee-script/register');
require('./gulpfile.coffee');
</code></pre></div>
      <div class='step' >
    
<p><strong>gulpfile.coffee</strong></p>
<pre><code class='prettyprint '>gulp = require('gulp')
coffee = require('gulp-coffee')

# coffeeをjsに変換する
gulp.task 'js', ->
  gulp.src('app/*.coffee')
      .pipe(coffee())
      .pipe gulp.dest('app/')
  gulp.src('test/*.coffee')
      .pipe(coffee())
      .pipe gulp.dest('test/')
</code></pre></div>
      <div class='step' >
    
<h2>コマンドの実行（npm）</h2>

<p><strong>package.json</strong></p>
<pre><code class='prettyprint '>  ...
  "scripts": {
    "js": "gulp js" ← 追加する
  },
  ...
</code></pre>
<p>以下のように <code class='inline prettyprint'>npm run &lt; command &gt;</code> コマンドを打てば、ローカルのコマンドを実行できる。よって、グローバルには何も入れなくて良い。</p>
<pre><code class='prettyprint '>$ npm run js
</code></pre>
<p>coffeeファイルがjsファイルに変換されていることを確認する</p>
</div>
      <div class='step' >
    
<h2>coffeeファイルの更新を監視する</h2>

<p><strong>gulpfile.coffee</strong> に追記する</p>
<pre><code class='prettyprint '>...
# coffeeファイルの更新を監視する
gulp.task 'watch', ->
  gulp.watch [
    'app/*.coffee'
    'test/*.coffee'
  ], -> gulp.start 'js'
</code></pre></div>
      <div class='step' >
    
<p><strong>package.json</strong> に追記する</p>
<pre><code class='prettyprint '>  ...
  "scripts": {
    "js": "gulp js",
    "watch": "gulp watch" ← 追加する
  },
  ...
</code></pre>
<p>これで、以下のコマンドを打つと・・・</p>
<pre><code class='prettyprint '>$ npm run watch
</code></pre>
<p>coffeeファイルの更新を監視し始める。</p>
</div>
      <div class='step' >
    
<h2>ファイルが更新されたらテストを走らせる</h2>

<p><strong>gulpfile.coffee</strong> に追記する</p>
<pre><code class='prettyprint '>...
mocha = require('gulp-mocha')
...
# mochaでテストする
gulp.task 'test', ->
  gulp.src( 'test/*.test.coffee', {read: false} )
    .pipe( mocha( {reporter: 'nyan'} ) )
...
</code></pre></div>
      <div class='step' >
    
<p><strong>gulpfile.coffee</strong> に追記する</p>
<pre><code class='prettyprint '># coffeeファイルの更新を監視する
gulp.task 'watch', ->
  gulp.watch [
    'app/*.coffee'
    'test/*.coffee'
  ], -> 
    gulp.start 'js'
    gulp.start 'test' ← 追加する
</code></pre>
<p>これで、以下のコマンドを打つと・・・</p>
<pre><code class='prettyprint '>$ npm run watch
</code></pre>
<p>coffeeファイルを監視し、更新があればJS変換とテストが自動的に行われる。</p>
</div>
      <div class='step' >
    
<h1>準備完了</h1>

<p>あとは <code class='inline prettyprint'>app/*.coffee</code> と <code class='inline prettyprint'>test/*.test.coffee</code> を書いていく</p>
</div>
      <div class='step' >
    
<h2>Mocha</h2>

<p><img src="image/mocha.png" alt="Mocha"></p>

<ul>
<li>javascriptの単体テストで使用されるテストフレームワーク</li>
<li>node.jsやブラウザから実行することや、非同期のテストも可能</li>
<li>なお、mocha自体はアサーション機能は持っていません。なので、値の検証は標準のassertとかchaiとかshouldとかexpectを使用します。</li>
<li>TDDやBDDスタイルでテストを記述でき、テスト結果もいろいろな形式で出力できます。</li>
<li>・・・というように汎用性が高いので、毎年トレンドが変わっていたJSテストフレームワークもようやく安定か？</li>
</ul>
</div>
      <div class='step' >
    
<h2>expectJS</h2>

<p><img src="image/LearnBoost.png" alt="expectJS"></p>

<ul>
<li><strong>should.js</strong> をべースに開発されたミニマムなBDDアサーションライブラリ</li>
<li><strong>mongoose</strong> や <strong>stylus</strong> の作者が作成</li>
<li>クロスブラウザ: IE6+, Firefox, Safari, Chrome, Operaで動作</li>
<li>全てのテスティングフレームワークと併用可能</li>
<li>Node.JSで使用可能(<code class='inline prettyprint'>require('expect.js')</code>)</li>
<li>スタンドアローン</li>
</ul>
</div>
      <div class='step' >
    
<h2>テストを書く</h2>
<pre><code class='prettyprint '>expect = require 'expect.js'
fizzbuzz = require '../app/FizzBuzz.js'

describe 'fizzbuzz', ->

    f = new fizzbuzz.FizzBuzz

    it 'return string Fizz when 3 is given', ->
        result = f.returnString( 3 )
        expect( result ).to.be( 'Fizz' )

</code></pre></div>
      <div class='step' >
    
<h2>コードを書く</h2>
<pre><code class='prettyprint '>root = exports ? this
class root.FizzBuzz
  returnString: (n) ->
    "Fizz" # ひどいｗ
</code></pre></div>
      <div class='step' >
    
<h1>以下開発</h1>

<p>おしまい</p>

      </div>
    <script src="js/impress.js"></script>
    <script>impress().init();</script>
  </body>
</html>
    